<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aimMapper">
	<!-- 목표 추가 -->
	<insert id="insertAim" parameterType="aimVO">
		insert into aim values (#{aimid}, #{aimdate}, #{moneytype}, #{catename}, #{total}, #{userid});
	</insert>
	
	<!-- 목표 가져오기 -->
	<select id="aimInfo" parameterType="aimVO" resultType="aimjoinVO">
		select a.aimid, a.moneytype, a.catename, a.total as aim_money, sum(c.total) as total
		from aim as a join account as c
		on left(c.date, 7) = aimdate and a.catename = c.catename
		where a.userid = #{userid} and a.moneytype = #{moneytype} and aimdate = #{aimdate} and (left(c.date, 7) = #{aimdate})
		group by c.catename
		union
		select aimid, moneytype, catename, total as aim_money, 0 as total from aim where userid = #{userid} and moneytype = #{moneytype} and aimdate = #{aimdate};
	</select>
	
	<!-- 목표 수정 -->
	<update id="updateAim" parameterType="aimVO">
		update aim set total = #{total} where aimid = #{aimid} and userid = #{userid};
	</update>
	
	<!-- 목표 삭제 -->
	<delete id="deleteAim" parameterType="aimVO">
		delete from aim where aimid = #{aimid} and userid = #{userid};
	</delete>
	
	<!-- 목표 카테고리 중복 확인 -->
	<select id="isOverlapAim" parameterType="aimVO" resultType="String">
		select catename from aim where aimdate = #{aimdate} and catename = #{catename} and userid = #{userid};
	</select>
</mapper>